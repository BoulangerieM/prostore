<form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
  <div fxLayout="row wrap" fxLayoutAlign="space-evenly space-evenly">
    <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
      <mat-label>Nom de votre entreprise</mat-label>
      <input
        matInput
        type="text"
        placeholder="Ex: Restaurant du port"
        formControlName="name"
        required
      />
      <mat-error *ngIf="orderForm.get('name')?.invalid">{{
        getErrorMessage("name")
      }}</mat-error>
    </mat-form-field>
    <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
      <mat-label>Numéro de téléphone</mat-label>
      <input
        matInput
        type="tel"
        placeholder="Ex: 0546331122"
        formControlName="phone"
        required
      />
      <mat-error *ngIf="orderForm.get('phone')?.invalid">{{
        getErrorMessage("phone")
      }}</mat-error>
    </mat-form-field>
  </div>
  <div formGroupName="address">
    <div fxLayout="row" fxLayoutAlign="center">
      <mat-form-field fxFlex="87" appearance="outline">
        <mat-label>Rue</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: 2 rue du port"
          formControlName="street"
          required
        />
        <mat-error *ngIf="orderForm.get('address')?.get('street')?.invalid">{{
          getErrorMessage("street", "address")
        }}</mat-error>
      </mat-form-field>
    </div>
    <div fxLayout="row wrap" fxLayoutAlign="space-evenly space-evenly">
      <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
        <mat-label>Code postal</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: 17000"
          formControlName="zipCode"
          required
        />
        <mat-error *ngIf="orderForm.get('address')?.get('zipCode')?.invalid">{{
          getErrorMessage("zipCode", "address")
        }}</mat-error>
      </mat-form-field>
      <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
        <mat-label>Ville</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: La Rochelle"
          formControlName="city"
          required
        />
        <mat-error *ngIf="orderForm.get('address')?.get('city')?.invalid">{{
          getErrorMessage("city", "address")
        }}</mat-error>
      </mat-form-field>
    </div>
  </div>
  <div
    fxLayout="row wrap"
    class="checkboxRow"
    fxLayoutAlign="flex-start center"
  >
    <mat-checkbox
      fxFlexOffset="7"
      (change)="hasDifferentDeliveryAddress($event.checked)"
      formControlName="hasDifferentDeliveryAddress"
      >Adresse de livraison différente</mat-checkbox
    >
  </div>
  <div formGroupName="deliveryAddress" *ngIf="displayDeliveryForm">
    <div fxLayout="row" fxLayoutAlign="center">
      <mat-form-field fxFlex="87" appearance="outline">
        <mat-label>Rue</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: 2 rue du port"
          formControlName="street"
          required
        />
        <mat-error
          *ngIf="orderForm.get('deliveryAddress')?.get('street')?.invalid"
          >{{ getErrorMessage("street", "address") }}</mat-error
        >
      </mat-form-field>
    </div>
    <div fxLayout="row wrap" fxLayoutAlign="space-evenly space-evenly">
      <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
        <mat-label>Code postal</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: 17000"
          formControlName="zipCode"
          required
        />
        <mat-error
          *ngIf="orderForm.get('deliveryAddress')?.get('zipCode')?.invalid"
          >{{ getErrorMessage("zipCode", "address") }}</mat-error
        >
      </mat-form-field>
      <mat-form-field fxFlex="40" fxFlex.lt-sm="87" appearance="outline">
        <mat-label>Ville</mat-label>
        <input
          matInput
          type="text"
          placeholder="Ex: La Rochelle"
          formControlName="city"
          required
        />
        <mat-error
          *ngIf="orderForm.get('deliveryAddress')?.get('city')?.invalid"
          >{{ getErrorMessage("city", "address") }}</mat-error
        >
      </mat-form-field>
    </div>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="flex-start center">
    <mat-form-field
      fxFlexOffset="7"
      fxFlex="40"
      fxFlex.lt-sm="87"
      appearance="outline"
      (click)="picker.open()"
    >
      <mat-label>Date de livraison</mat-label>
      <input
        matInput
        required
        formControlName="deliveryDate"
        [min]="tomorrow"
        [matDatepicker]="picker"
        readonly
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker disabled="false"></mat-datepicker>
      <mat-error *ngIf="orderForm.get('deliveryDate')?.invalid">{{
        getErrorMessage("deliveryDate")
      }}</mat-error>
    </mat-form-field>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="center center">
    <p class="deliveryMessage" *ngIf="showDeliveryMessage">
      Votre livraison vous sera livrée à l'adresse renseignée le
      {{ orderForm.get("deliveryDate")?.value | date: "fullDate" }} entre 10
      heures et midi.
    </p>
    <p
      class="warningMessage"
      *ngIf="showShortDeliveryMessage || showOrderNeedValidationMessage"
    >
      <span> Attention, dû au délai court de votre commande: </span>
      <span *ngIf="showOrderNeedValidationMessage">
        <br />&nbsp;&nbsp;- Elle devra être validée par la boulangerie M. Sans
        retour de leur part dans l'heure, considérez la comme annulée.
      </span>
      <span *ngIf="showShortDeliveryMessage">
        <br />&nbsp;&nbsp;- Certains produits ne sont pas disponibles. Ils ont
        été désactivés dans le formulaire.
      </span>
    </p>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="center center">
    <mat-divider fxFlex="50"></mat-divider>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="center center">
    <h2>Produits</h2>
  </div>

  <div fxLayout="row wrap" fxLayoutAlign="space-evenly space-evenly">
    <div *ngIf="!productList.length">
      <mat-spinner></mat-spinner>
    </div>

    <mat-card
      *ngFor="let product of productList"
      fxFlex="40"
      fxFlex.lt-sm="87"
      [ngClass]="{
        unavailableItem: showShortDeliveryMessage && !product.shortDelivery
      }"
    >
      <mat-expansion-panel [disabled]="!product.description">
        <mat-expansion-panel-header>
          <mat-panel-title>{{ product.name }}</mat-panel-title>
        </mat-expansion-panel-header>
        <p>{{ product.description }}</p>
      </mat-expansion-panel>
      <mat-card-content
        fxLayout="row wrap"
        fxLayoutAlign="space-between baseline"
      >
        <div>Prix: {{ product.price }} € H.T. / {{ product.unit }}</div>
        <div>
          <mat-form-field
            [formGroup]="itemFormGroup"
            class="quantityInput"
            appearance="outline"
          >
            <mat-label>Quantité</mat-label>
            <input matInput type="number" [formControlName]="product.name" />
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="center center">
    <mat-divider fxFlex="50"></mat-divider>
  </div>
  <div
    fxLayout="column wrap"
    fxLayoutAlign="center center"
    *ngIf="orderForm.get('totalPrice')?.value > 0"
  >
    <h2 fxFlex="50">Prix total de la commande:</h2>
    <h2 fxFlex="50">{{ orderForm.get("totalPrice")?.value }} € H.T.</h2>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="center center" class="buttonRow">
    <button fxFlex="40" fxFlex.lt-sm="87" mat-raised-button type="submit">
      Commander
    </button>
  </div>
</form>
<!-- VOIR POUR CHANGER TYPE EN TEL CAR AFFICHE SUR MOBILE DES CHAMPS DE MERDE -->
<!--
Un calendrier afin de spécifier le créneau de retrait désiré avec le comportement suivant:
Date minimum :
Si avant 11h00 (J1), livraison (J2) entre 10h00 et 12h00
Si entre 11h et 18h (J-1) validation manuelle par une personne de la boulangerie
(afin qu'elle puisse consulter les personnes en production et contacter le client
si besoin de précisions avant validation ; le tout doit-être effectué dans l'heure de la prise de
commande 1h, avant annulation automatique)

 Pour une livraison le lendemain entre 10h et 12h aussi => NON CAR CEST COMMANDE PLUS TARD,
 ON N’AFFICHE PAS LE MESSAGE DE BASE,  A VOIR PLUS TARD SI ON METS UN AUTRE MESSAGE :

Si la date de retrait est entre 0 et 24h, certains produits de la liste ne seront pas disponibles
(visible mais non sélectionnable). De plus, un message avertira l’utilisateur de cette contrainte.
(A DÉFINIR, EN FAIRE UNE TACHE)
Si la date choisie est supérieur à 48h, aucune contrainte
 -->
